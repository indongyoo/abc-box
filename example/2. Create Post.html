<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>abcjs - TEST</title>
</head>
<body>
<script src="js/underscore.js"></script>
<script src="js/jquery.js"></script>
<script src="js/abc.js"></script>
<script src="../abc.box.js"></script>
<script>
  var id = 2;

  // 서버에서 아래 html을 생성하기 위해 꺼냈던 data를 javascript 영역에 프린트 해두기
  var box = new Box('posts', [
    { id: 2, comment_count: 2 },
    { id: 1, comment_count: 5 }
  ]);

  var current_data = function() {
    console.log(JSON.stringify(box.sel('posts')));
  };

  G.$post_$create = B2(
    G.$t_$post_items = H.each('post', '\
      .post_item[box_selector="posts->($.id=={{post.id}})"]\
        .body {{post.body}}\
        .options\
          button[type=button].remove 삭제'),
    $,
    B.method('prependTo', '.post_list'));

  $(function() {
    $('.post_editor').on('click', 'button', function(e) {
      var jq_post_editor = $(e.delegateTarget);
      C({
        id: ++id,
        body: jq_post_editor.find('input').val(),
        comment_count: 0
      }, [
        B.args_pass('box.unshift("posts", $)'),
        C.wrap_arr,
        G.$post_$create,
        function() {
          jq_post_editor.find('input').val('');
          current_data();
        }
      ]);
    });

    $('.post_list').on('click', '.post_item .remove', function(e) {
      var jq_post_item = $(e.currentTarget).closest('.post_item');
      box.remove(jq_post_item);
      jq_post_item.remove();
      current_data();
    });
  });

</script>

<div class="post_editor">
  <input type="text">
  <button type="button">확인</button>
</div>

<!-- 서버에서 생성한 html -->
<div class="post_list">
  <div class="post_item" box_selector="posts->($.id==2)">
    <div class="body">포스트2</div>
    <div class="options">
      <button type="button" class="remove">삭제</button>
    </div>
  </div>
  <div class="post_item" box_selector="posts->($.id==1)">
    <div class="body">포스트1</div>
    <div class="options">
      <button type="button" class="remove">삭제</button>
    </div>
  </div>
</div>

</body>
</html>
